<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>溫SINT地圖</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="preload" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <!-- Plugins: Leaflet.draw + PolylineMeasure -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.polylinemeasure/Leaflet.PolylineMeasure.css" />
  <link rel="stylesheet" href="static/css/main.css">
</head>
<body>
  <!-- 頂部提醒 -->
  <div id="topNotice" class="top-notice" role="status" aria-live="polite">
    ⚠️ 圖資 preload 可能造成首次卡頓；遇效能問題可重新整理
  </div>
  <div id="map"></div>

  <!-- 載入指示器 -->
  <div id="loading" class="loading">
    <div class="spinner"></div>
    <div>載入地圖資料中...</div>
  </div>

  <!-- 手機版固定搜尋列 -->
  <div id="mobileSearchBar" class="mobile-search-bar">
    <div class="mobile-search-container">
      <button class="mobile-toggle-panel" onclick="togglePanel()" aria-label="開啟地圖控制">⚙️</button>
      <div class="mobile-search-input-wrapper">
        <input type="text" id="mobileSearchInput" class="mobile-search-input" placeholder="搜尋地點..." autocomplete="off" aria-label="搜尋地點">
        <button id="mobileClearBtn" class="mobile-clear-btn" onclick="clearMobileSearch()" aria-label="清除搜尋" style="display: none;">✕</button>
      </div>
    </div>
    <div id="mobileSearchResults" class="mobile-search-results" style="display: none;" role="listbox" aria-label="搜尋結果"></div>
  </div>

  <!-- 控制面板 -->
  <div id="controlPanel" class="control-panel" onclick="event.stopPropagation();">
    <div class="control-title">地圖控制</div>
    <div id="mobileHint" class="mobile-hint" style="display: none;">
      請點擊地圖任意處關閉此面板
    </div>

    <!-- 地點搜尋 -->
    <div class="input-group">
      <label class="input-label">搜尋地點</label>
      <div class="search-container">
        <input type="text" id="searchInput" class="input-field search-input" placeholder="輸入地點名稱..." autocomplete="off" aria-label="搜尋地點">
        <button class="btn btn-search" onclick="performSearch()" aria-label="執行搜尋">搜尋</button>
      </div>
      <div id="searchResults" class="search-results" style="display: none;" role="listbox" aria-label="搜尋結果"></div>
    </div>

    <div class="input-group">
      <label class="input-label">緯度 (Latitude)</label>
      <input type="number" id="latInput" class="input-field" step="any" placeholder="例如: 31.9424765">
    </div>
    
    <div class="input-group">
      <label class="input-label">經度 (Longitude)</label>
      <input type="number" id="lngInput" class="input-field" step="any" placeholder="例如: 120.2903877">
    </div>
    
    <div class="input-group">
      <label class="input-label">搜尋半徑 (公里)</label>
      <input type="number" id="radiusInput" class="input-field" value="50" min="1" max="500" step="5">
    </div>
    
    <div class="input-group">
      <label class="input-label">分層篩選</label>
      <select id="layerFilter" class="input-field" onchange="filterByLayer()">
        <option value="">顯示全部分層</option>
        <option value="中國軍工及航天產業">中國軍工及航天產業</option>
        <option value="武裝警察、海外軍事設施及其他分類">武裝警察、海外軍事設施</option>
        <option value="解放軍海軍、海軍陸戰隊基地及設施">解放軍海軍、海軍陸戰隊</option>
        <option value="解放軍火箭軍">解放軍火箭軍</option>
        <option value="解放軍空軍、海軍航空兵基地及設施">解放軍空軍、海軍航空兵</option>
        <option value="解放軍軍事航天部隊、網路空間部隊、信息支援部隊">軍事航天、網路空間部隊</option>
        <option value="解放軍軍事院校、教育單位">解放軍軍事院校、教育</option>
        <option value="解放軍重要訓場/特殊設施">解放軍重要訓場/特殊設施</option>
        <option value="解放軍陸軍、陸軍防空單位、聯勤保障設施、預備役部隊(部分設施為個人推斷)">解放軍陸軍、聯勤保障</option>
        <option value="黨和國家重要政經軍事機關">黨和國家重要政經軍事機關</option>
      </select>
    </div>
    
    <button class="btn btn-primary" onclick="searchLocation()">搜尋位置</button>
    <button class="btn btn-secondary" id="toggleUnitsBtn" onclick="toggleUnitsVisibility()">隱藏單位</button>
    <button class="btn btn-secondary" onclick="copyUrl()">複製連結</button>
    <button class="btn btn-secondary" onclick="clearDrawings()">清除繪圖</button>
    
    <div id="infoPanel" class="info-panel" style="display: none;">
      <div id="infoText"></div>
    </div>
  </div>
  
  <!-- 隱藏面板按鈕 -->
  <button class="toggle-panel" onclick="togglePanel()">⚙️</button>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" defer></script>
  <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js" defer></script>
  <script src="https://unpkg.com/leaflet.polylinemeasure/Leaflet.PolylineMeasure.min.js" defer></script>
  <!-- OpenCC.js for Traditional/Simplified Chinese conversion -->
  <script src="https://cdn.jsdelivr.net/npm/opencc-js@1.0.5/dist/umd/full.js"></script>
  <script src="static/js/shape_utils.js" defer></script>
  <script src="static/js/equipment_parser.js" defer></script>
  <script src="static/js/search_utils.js" defer></script>
  <script src="static/js/main.js" defer></script>
</body>
</html>
